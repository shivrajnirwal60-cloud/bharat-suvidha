<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bharat Suvidha - Premium Retailer Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* --- PREMIUM MATTE & GLASS THEME --- */
        body {
            background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #1e293b;
        }

        /* The Matte Glass Effect */
        .matte-glass {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        /* Card Interactions */
        .service-card {
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .service-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
            background: #ffffff;
            z-index: 10;
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-up { animation: fadeIn 0.5s ease-out forwards; }

        /* Utilities */
        #dashboard, #panFormModal { display: none; }
        .loader { width: 18px; height: 18px; border: 2px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loginGate" class="fixed inset-0 z-[999] bg-slate-900/90 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="matte-glass rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-up">
            <div class="bg-gradient-to-br from-blue-800 to-blue-900 p-10 text-center text-white relative overflow-hidden">
                <div class="w-20 h-20 bg-white text-blue-900 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl font-bold shadow-lg transform rotate-3">BS</div>
                <h1 class="text-3xl font-extrabold tracking-tight">Bharat Suvidha</h1>
                <p class="text-blue-200 text-sm mt-2 font-medium tracking-widest uppercase">Authorized Retailer Access</p>
            </div>
            <div class="p-8">
                <form onsubmit="handleLogin(event)" class="space-y-6">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1">User ID</label>
                        <input type="email" id="userid" required class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white/50 backdrop-blur-sm transition outline-none" placeholder="admin@bharat.com">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1">Password</label>
                        <input type="password" id="password" required class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white/50 backdrop-blur-sm transition outline-none" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
                    </div>
                    <button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95 flex justify-center items-center gap-2">
                        SECURE LOGIN <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
                <div id="loginError" class="mt-4 p-3 bg-red-100/80 text-red-700 text-center text-sm font-bold rounded-lg hidden border border-red-200"></div>
            </div>
        </div>
    </div>

    <div id="dashboard">
        
        <nav class="matte-glass sticky top-0 z-50 border-b border-white/40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-tr from-red-600 to-red-700 text-white rounded-lg flex items-center justify-center font-bold text-xl shadow-md">BS</div>
                    <div>
                        <h1 class="font-bold text-gray-800 text-lg leading-none">Bharat Suvidha</h1>
                        <p class="text-[10px] text-gray-500 font-bold tracking-widest uppercase">Digital Seva Kendra</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <div class="flex items-center bg-slate-800 text-white px-3 py-1.5 rounded-full shadow-lg border border-slate-600 hover:scale-105 transition cursor-default">
                        <i class="fas fa-wallet text-yellow-400 mr-2.5"></i>
                        <span id="walletBalance" class="font-mono font-bold text-lg mr-3">â‚¹ ...</span>
                        <button onclick="addMoney()" class="bg-green-500 hover:bg-green-600 text-white text-[10px] px-3 py-1 rounded-full font-bold uppercase transition shadow-md">
                            + Add
                        </button>
                    </div>
                    <button onclick="logout()" class="w-10 h-10 rounded-full bg-red-50 text-red-600 hover:bg-red-500 hover:text-white flex items-center justify-center transition border border-red-100 shadow-sm">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>
        </nav>

        <div class="bg-slate-800 text-white py-2 border-b-4 border-yellow-500 relative z-40 shadow-md">
            <div class="container mx-auto flex items-center px-4">
                <span class="bg-green-600 px-2 py-0.5 rounded text-[10px] font-bold uppercase animate-pulse mr-3 shadow">Live</span>
                <marquee class="text-sm font-medium text-gray-300">
                    ðŸš€ New Feature: "Print PAN" Auto-loads Template! | âš¡ Instant PDF Generation Active | ðŸ“… Support Available 10 AM - 6 PM
                </marquee>
            </div>
        </div>

        <main class="container mx-auto px-4 py-8 pb-32">
            
            <div class="flex justify-center mb-10">
                <div class="matte-glass px-8 py-2 rounded-full flex items-center gap-3 shadow-sm">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Operator:</span>
                    <span id="welcomeUser" class="font-bold text-gray-800 text-sm">Loading...</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <button onclick="openPanForm()" class="group relative overflow-hidden bg-gradient-to-br from-blue-600 to-blue-800 text-white p-8 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 text-left w-full">
                    <div class="absolute right-0 top-0 w-40 h-40 bg-white/10 rounded-full -mr-10 -mt-10 blur-3xl group-hover:bg-white/20 transition"></div>
                    <div class="relative z-10">
                        <h3 class="text-2xl font-extrabold mb-1 tracking-tight">Print PAN Card</h3>
                        <p class="text-blue-100 text-xs font-semibold bg-blue-900/40 inline-block px-2 py-1 rounded border border-blue-400/30">Form 49A (Instant)</p>
                    </div>
                    <div class="absolute bottom-6 right-6 opacity-80 group-hover:scale-110 transition transform">
                        <i class="fas fa-print text-5xl text-white/90"></i>
                    </div>
                </button>

                <button class="group relative overflow-hidden bg-gradient-to-br from-teal-600 to-teal-800 text-white p-8 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 text-left w-full">
                    <div class="relative z-10">
                        <h3 class="text-2xl font-extrabold mb-1 tracking-tight">Correction</h3>
                        <p class="text-teal-100 text-xs font-semibold bg-teal-900/40 inline-block px-2 py-1 rounded border border-teal-400/30">Update Name / DOB</p>
                    </div>
                    <i class="fas fa-user-edit text-5xl text-white/90 absolute bottom-6 right-6 opacity-80"></i>
                </button>

                <button class="group relative overflow-hidden bg-gradient-to-br from-indigo-600 to-indigo-800 text-white p-8 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 text-left w-full">
                    <div class="relative z-10">
                        <h3 class="text-2xl font-extrabold mb-1 tracking-tight">Training</h3>
                        <p class="text-indigo-100 text-xs font-semibold bg-indigo-900/40 inline-block px-2 py-1 rounded border border-indigo-400/30">Video Tutorials</p>
                    </div>
                    <i class="fas fa-headset text-5xl text-white/90 absolute bottom-6 right-6 opacity-80"></i>
                </button>
            </div>

            <div class="matte-glass rounded-3xl p-8 shadow-xl">
                <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3"><span class="w-10 h-10 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center shadow-sm"><i class="fas fa-th"></i></span> All Services</h2>
                    <span class="bg-gray-100 text-gray-500 text-xs font-bold px-3 py-1 rounded-full">15 Active</span>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    <div onclick="openPanForm()" class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40 border-2 border-purple-100 bg-purple-50/20 group">
                        <div class="absolute top-2 right-2 bg-purple-600 text-white text-[9px] font-bold px-2 py-0.5 rounded shadow-sm">HOT</div>
                        <i class="fas fa-print text-purple-600 text-3xl mb-3 group-hover:scale-110 transition duration-300"></i>
                        <h4 class="text-sm font-extrabold text-purple-900">Print Any Card</h4>
                    </div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40 border-2 border-blue-100 bg-blue-50/20 group">
                        <div class="absolute top-2 right-2 bg-red-500 text-white text-[9px] font-bold px-2 py-0.5 rounded shadow-sm">NEW</div>
                        <i class="fas fa-motorcycle text-blue-600 text-3xl mb-3 group-hover:scale-110 transition duration-300"></i>
                        <h4 class="text-sm font-extrabold text-blue-900">MH Vehicle RC</h4>
                    </div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-search text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Find PAN</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-check-circle text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">PAN Verify</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-university text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Bank Verify</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-person-booth text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Voter ID</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-car text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">RC Verify</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-id-badge text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">DL Verify</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-file-invoice text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Challan</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-store text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">GST Check</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-industry text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Udyog</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-passport text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Passport</h4></div>
                </div>
            </div>
        </main>
        
        <footer class="bg-slate-900 text-slate-400 py-12 text-center text-xs border-t border-slate-800">
            <p>&copy; 2025 Bharat Suvidha Kendra. All Rights Reserved.</p>
        </footer>
    </div>

    <div id="panFormModal" class="fixed inset-0 z-[1000] bg-slate-900/90 hidden flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-up">
            <div class="bg-gradient-to-r from-blue-700 to-blue-800 p-6 text-white flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h3 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-print"></i> Print PAN Card</h3>
                    <p class="text-blue-200 text-xs">Auto-filling '1000067800.jpg' (Fee: â‚¹10)</p>
                </div>
                <button onclick="closePanForm()" class="bg-white/20 hover:bg-white/30 rounded-full w-8 h-8 flex items-center justify-center transition">âœ•</button>
            </div>
            
            <form id="newPanForm" onsubmit="handlePanSubmit(event)" class="p-8 space-y-5">
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">PAN Number</label>
                        <input type="text" id="pan_number" required pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" class="w-full px-4 py-2.5 border rounded-lg uppercase font-mono border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="ABCDE1234F">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Date of Birth</label>
                        <input type="date" id="pan_dob" required class="w-full px-4 py-2.5 border rounded-lg border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Full Name</label>
                        <input type="text" id="pan_name" required class="w-full px-4 py-2.5 border rounded-lg uppercase border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="RAJESH KUMAR">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1">Father's Name</label>
                        <input type="text" id="pan_fname" required class="w-full px-4 py-2.5 border rounded-lg uppercase border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="SURESH KUMAR">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-4 border-t">
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center cursor-pointer hover:bg-blue-50 transition group" onclick="document.getElementById('pan_photo').click()">
                        <i class="fas fa-camera text-gray-400 mb-2 group-hover:text-blue-500"></i>
                        <p class="text-xs font-bold text-gray-600 group-hover:text-blue-600">Select Photo</p>
                        <input type="file" id="pan_photo" accept="image/*" class="hidden" onchange="previewImage(this, 'photo_preview')">
                        <img id="photo_preview" class="h-16 w-16 object-cover mx-auto mt-2 rounded hidden border shadow-sm">
                    </div>
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center cursor-pointer hover:bg-blue-50 transition group" onclick="document.getElementById('pan_signature').click()">
                        <i class="fas fa-pen-nib text-gray-400 mb-2 group-hover:text-blue-500"></i>
                        <p class="text-xs font-bold text-gray-600 group-hover:text-blue-600">Select Signature</p>
                        <input type="file" id="pan_signature" accept="image/*" class="hidden" onchange="previewImage(this, 'sig_preview')">
                        <img id="sig_preview" class="h-8 w-auto object-contain mx-auto mt-2 hidden border shadow-sm">
                    </div>
                </div>

                <button type="submit" id="generateBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-3.5 rounded-xl shadow-lg flex justify-center items-center gap-2 mt-4 text-lg transition transform active:scale-95">
                    <i class="fas fa-print"></i> Confirm & Print (â‚¹10)
                </button>
            </form>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script>
        // 1. FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAKEeuQkW8Ry-365dYos96Dzp0TlO_Upog",
            authDomain: "bharat-suvidha-faeee.firebaseapp.com",
            projectId: "bharat-suvidha-faeee",
            storageBucket: "bharat-suvidha-faeee.firebasestorage.app",
            messagingSenderId: "969934230576",
            appId: "1:969934230576:web:8d2bbcf3e5cf3d689c09f5",
            measurementId: "G-PNJ0DQ9EQJ"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;

        // UI HELPERS
        function openPanForm() { document.getElementById('panFormModal').style.display = 'flex'; }
        function closePanForm() { document.getElementById('panFormModal').style.display = 'none'; }
        function previewImage(input, id) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(id).src = e.target.result;
                    document.getElementById(id).classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // LOGIN SYSTEM
        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const errorBox = document.getElementById('loginError');
            btn.innerHTML = '<span class="loader"></span>';
            errorBox.classList.add('hidden');
            try {
                await auth.signInWithEmailAndPassword(
                    document.getElementById('userid').value,
                    document.getElementById('password').value
                );
            } catch (error) {
                btn.innerHTML = 'SECURE LOGIN <i class="fas fa-arrow-right"></i>';
                errorBox.innerText = "Error: " + error.code;
                errorBox.classList.remove('hidden');
            }
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('welcomeUser').innerText = user.email;
                loadWallet(user);
            } else {
                currentUser = null;
                document.getElementById('loginGate').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        // WALLET SYSTEM
        async function loadWallet(user) {
            const walletRef = db.collection('users').doc(user.uid);
            try {
                const doc = await walletRef.get();
                if (doc.exists) {
                    updateWalletUI(doc.data().balance);
                } else {
                    await walletRef.set({ email: user.email, balance: 0 });
                    updateWalletUI(0);
                }
            } catch (e) { console.error(e); }
        }

        function updateWalletUI(amount) {
            const el = document.getElementById('walletBalance');
            el.innerText = "â‚¹ " + parseFloat(amount || 0).toFixed(2);
            if (amount > 50) el.classList.add("text-green-400");
        }

        // PAYMENT SYSTEM (TEST MODE)
        function addMoney() {
            if (!currentUser) return;
            let amount = prompt("Enter amount (e.g. 100):");
            if (!amount || amount < 1) return;

            var options = {
                "key": "rzp_live_RyxBU2CVQ5QLdp",
                "amount": amount * 100,
                "currency": "INR",
                "name": "Bharat Suvidha",
                "description": "Recharge",
                "handler": async function (response) {
                    const walletRef = db.collection('users').doc(currentUser.uid);
                    const doc = await walletRef.get();
                    const newBal = (doc.data().balance || 0) + parseInt(amount);
                    await walletRef.update({ balance: newBal });
                    updateWalletUI(newBal);
                    alert("Success! Balance Updated.");
                },
                "theme": { "color": "#2563eb" }
            };
            
            if (typeof Razorpay !== 'undefined') {
                new Razorpay(options).open();
            } else {
                alert("Payment gateway blocked. Check internet connection.");
            }
        }

        // PDF GENERATION SYSTEM (Calibrated to 1000067800.jpg)
        async function handlePanSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('generateBtn');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = '<span class="loader"></span> Printing...';
            btn.disabled = true;

            const walletRef = db.collection('users').doc(currentUser.uid);
            
            try {
                // Check Balance
                const doc = await walletRef.get();
                const currentBal = doc.data().balance || 0;
                
                if (currentBal < 10) {
                    alert("Insufficient Balance! Recharge required.");
                    throw new Error("Low Balance");
                }

                // Generate PDF
                await generatePDF();

                // Deduct Money
                const newBal = currentBal - 10;
                await walletRef.update({ balance: newBal });
                updateWalletUI(newBal);
                
                alert("Success! PDF Generated. â‚¹10 Deducted.");
                closePanForm();

            } catch (error) {
                console.error(error);
                if(error.message !== "Low Balance") alert("Error: " + error.message);
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');

            // --- AUTO LOAD IMAGE (MUST BE IN FOLDER AS 1000067800.jpg) ---
            try {
                const bg = await loadImage('1000067800.jpg'); 
                doc.addImage(bg, 'JPEG', 0, 0, 210, 297);
            } catch (e) {
                alert("Template '1000067800.jpg' not found in folder!");
                throw e;
            }

            // Get Data
            const name = document.getElementById('pan_name').value.toUpperCase();
            const fname = document.getElementById('pan_fname').value.toUpperCase();
            const dob = document.getElementById('pan_dob').value.split('-').reverse().join('/');
            const pan = document.getElementById('pan_number').value.toUpperCase();
            const photo = document.getElementById('photo_preview').src;
            const sig = document.getElementById('sig_preview').src;

            // --- PRECISION COORDINATES (SHIFTED DOWN +7mm) ---
            doc.setFont("helvetica", "bold");
            doc.setTextColor(0, 0, 0);

            // 1. TOP SECTION (Letter) - Shifted +7mm Down
            doc.setFontSize(11);
            doc.text(pan, 140, 30);  // PAN Number Top Right (Blue Bar - Unchanged)
            
            doc.setFontSize(10);
            doc.text(name, 50, 75);  // Was 58 -> Now 65 (Moved Down)
            doc.text(fname, 50, 90); // Was 83 -> Now 90 (Moved Down)
            doc.text(dob, 50, 105);  // Was 108 -> Now 115 (Moved Down)

            
            // Images Top
            if (photo.startsWith('data:')) doc.addImage(photo, 'JPEG', 12, 140, 25, 30); // Shifted Photo Down
            if (sig.startsWith('data:')) doc.addImage(sig, 'PNG', 80, 150, 40, 10);     // Shifted Sig Down

            // 2. BOTTOM SECTION (Card Cutout) - Fine Tuned
            doc.setFontSize(7);
            doc.text(name, 27, 259); // Name
            doc.text(fname, 27, 264); // Father's Name
            doc.text(dob, 27, 269); // DOB
            
            doc.setFontSize(8);
            doc.text(pan, 32, 250); // PAN Number (Bold)

            // Images Bottom
            if (photo.startsWith('data:')) doc.addImage(photo, 'JPEG', 10, 225, 18, 22);
            if (sig.startsWith('data:')) doc.addImage(sig, 'PNG', 35, 252, 25, 7);

            doc.save(name + "_PAN.pdf");
        }

        function loadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error("Img Error"));
                img.src = url;
            });
        }

        window.logout = function() {
            auth.signOut().then(() => location.reload());
        }
    </script>
</body>

</html>


