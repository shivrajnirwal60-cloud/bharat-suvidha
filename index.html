<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bharat Suvidha - Premium Retailer Portal</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <style>
        /* --- PREMIUM MATTE & GLASS THEME --- */
        body {
            background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', system-ui, sans-serif;
            color: #1e293b;
        }

        /* The Matte Glass Effect */
        .matte-glass {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.07);
        }

        /* Card Interactions */
        .service-card {
            background: rgba(255, 255, 255, 0.9);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.5);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }
        .service-card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px -5px rgba(0, 0, 0, 0.1);
            border-color: #3b82f6;
            background: #ffffff;
            z-index: 10;
        }

        /* Form Input Styles */
        .form-input {
            width: 100%; padding: 0.625rem 1rem; border: 1px solid #e2e8f0; border-radius: 0.5rem; outline: none; transition: all 0.2s;
        }
        .form-input:focus { ring: 2px solid #3b82f6; border-color: #3b82f6; }
        .form-label {
            display: block; font-size: 0.75rem; font-weight: 700; color: #64748b; text-transform: uppercase; margin-bottom: 0.25rem;
        }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-up { animation: fadeIn 0.5s ease-out forwards; }

        /* Utilities */
        #dashboard, #panFormModal, #rcFormModal, #farmerIdModal { display: none; }
        .modal-container { position: fixed; inset: 0; z-index: 1000; background-color: rgba(15, 23, 42, 0.9); display: flex; align-items: center; justify-content: center; padding: 1rem; backdrop-filter: blur(4px); display: none; }
        .loader { width: 18px; height: 18px; border: 2px solid #FFF; border-bottom-color: transparent; border-radius: 50%; display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loginGate" class="fixed inset-0 z-[999] bg-slate-900/90 flex items-center justify-center p-4 backdrop-blur-sm">
        <div class="matte-glass rounded-3xl shadow-2xl w-full max-w-md overflow-hidden animate-fade-up">
            <div class="bg-gradient-to-br from-blue-800 to-blue-900 p-10 text-center text-white relative overflow-hidden">
                <div class="w-20 h-20 bg-white text-blue-900 rounded-2xl flex items-center justify-center mx-auto mb-4 text-3xl font-bold shadow-lg transform rotate-3">BS</div>
                <h1 class="text-3xl font-extrabold tracking-tight">Bharat Suvidha</h1>
                <p class="text-blue-200 text-sm mt-2 font-medium tracking-widest uppercase">Authorized Retailer Access</p>
            </div>
            <div class="p-8">
                <form onsubmit="handleLogin(event)" class="space-y-6">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1">User ID</label>
                        <input type="email" id="userid" required class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white/50 backdrop-blur-sm transition outline-none" placeholder="admin@bharat.com">
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1">Password</label>
                        <input type="password" id="password" required class="w-full px-4 py-3.5 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 bg-white/50 backdrop-blur-sm transition outline-none" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <button type="submit" id="loginBtn" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 rounded-xl shadow-lg transition transform active:scale-95 flex justify-center items-center gap-2">
                        SECURE LOGIN <i class="fas fa-arrow-right"></i>
                    </button>
                </form>
                <div id="loginError" class="mt-4 p-3 bg-red-100/80 text-red-700 text-center text-sm font-bold rounded-lg hidden border border-red-200"></div>
            </div>
        </div>
    </div>

    <div id="dashboard">
        
        <nav class="matte-glass sticky top-0 z-50 border-b border-white/40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-tr from-red-600 to-red-700 text-white rounded-lg flex items-center justify-center font-bold text-xl shadow-md">BS</div>
                    <div>
                        <h1 class="font-bold text-gray-800 text-lg leading-none">Bharat Suvidha</h1>
                        <p class="text-[10px] text-gray-500 font-bold tracking-widest uppercase">Digital Seva Kendra</p>
                    </div>
                </div>

                <div class="flex items-center gap-4">
                    <div class="flex items-center bg-slate-800 text-white px-3 py-1.5 rounded-full shadow-lg border border-slate-600 hover:scale-105 transition cursor-default">
                        <i class="fas fa-wallet text-yellow-400 mr-2.5"></i>
                        <span id="walletBalance" class="font-mono font-bold text-lg mr-3">‚Çπ ...</span>
                        <button onclick="addMoney()" class="bg-green-500 hover:bg-green-600 text-white text-[10px] px-3 py-1 rounded-full font-bold uppercase transition shadow-md">
                            + Add
                        </button>
                    </div>
                    <button onclick="logout()" class="w-10 h-10 rounded-full bg-red-50 text-red-600 hover:bg-red-500 hover:text-white flex items-center justify-center transition border border-red-100 shadow-sm">
                        <i class="fas fa-power-off"></i>
                    </button>
                </div>
            </div>
        </nav>

        <div class="bg-slate-800 text-white py-2 border-b-4 border-yellow-500 relative z-40 shadow-md">
            <div class="container mx-auto flex items-center px-4">
                <span class="bg-green-600 px-2 py-0.5 rounded text-[10px] font-bold uppercase animate-pulse mr-3 shadow">Live</span>
                <marquee class="text-sm font-medium text-gray-300">
                    üöÄ Instant PDF Generation Active for: PAN Card, Vehicle RC, and Farmer ID! | ‚ö° ‚Çπ10 Per Print | üìÖ Support 24/7
                </marquee>
            </div>
        </div>

        <main class="container mx-auto px-4 py-8 pb-32">
            
            <div class="flex justify-center mb-10">
                <div class="matte-glass px-8 py-2 rounded-full flex items-center gap-3 shadow-sm">
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-widest">Operator:</span>
                    <span id="welcomeUser" class="font-bold text-gray-800 text-sm">Loading...</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                
                <button onclick="openPanForm()" class="group relative overflow-hidden bg-gradient-to-br from-blue-600 to-blue-800 text-white p-8 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 text-left w-full">
                    <div class="absolute right-0 top-0 w-40 h-40 bg-white/10 rounded-full -mr-10 -mt-10 blur-3xl group-hover:bg-white/20 transition"></div>
                    <div class="relative z-10">
                        <h3 class="text-2xl font-extrabold mb-1 tracking-tight">Print PAN Card</h3>
                        <p class="text-blue-100 text-xs font-semibold bg-blue-900/40 inline-block px-2 py-1 rounded border border-blue-400/30">Form 49A (Instant)</p>
                    </div>
                    <div class="absolute bottom-6 right-6 opacity-80 group-hover:scale-110 transition transform">
                        <i class="fas fa-print text-5xl text-white/90"></i>
                    </div>
                </button>

                <button onclick="openRcForm()" class="group relative overflow-hidden bg-gradient-to-br from-purple-600 to-purple-800 text-white p-8 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 text-left w-full">
                    <div class="relative z-10">
                        <h3 class="text-2xl font-extrabold mb-1 tracking-tight">Vehicle RC Print</h3>
                        <p class="text-purple-100 text-xs font-semibold bg-purple-900/40 inline-block px-2 py-1 rounded border border-purple-400/30">Generate PDF (‚Çπ10)</p>
                    </div>
                    <i class="fas fa-car text-5xl text-white/90 absolute bottom-6 right-6 opacity-80 group-hover:scale-110 transition transform"></i>
                </button>

                <button onclick="openFarmerForm()" class="group relative overflow-hidden bg-gradient-to-br from-green-600 to-green-800 text-white p-8 rounded-2xl shadow-xl hover:shadow-2xl hover:scale-[1.02] transition duration-300 text-left w-full">
                    <div class="relative z-10">
                        <h3 class="text-2xl font-extrabold mb-1 tracking-tight">Make Farmer ID</h3>
                        <p class="text-green-100 text-xs font-semibold bg-green-900/40 inline-block px-2 py-1 rounded border border-green-400/30">Generate PDF (‚Çπ10)</p>
                    </div>
                    <i class="fas fa-tractor text-5xl text-white/90 absolute bottom-6 right-6 opacity-80 group-hover:scale-110 transition transform"></i>
                </button>
            </div>

            <div class="matte-glass rounded-3xl p-8 shadow-xl">
                <div class="flex items-center justify-between mb-8 pb-4 border-b border-gray-200">
                    <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-3"><span class="w-10 h-10 bg-blue-100 text-blue-600 rounded-xl flex items-center justify-center shadow-sm"><i class="fas fa-th"></i></span> Quick Access</h2>
                </div>
                
                <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                     <div onclick="openRcForm()" class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40 border-2 border-purple-100 bg-purple-50/20 group">
                        <div class="absolute top-2 right-2 bg-purple-600 text-white text-[9px] font-bold px-2 py-0.5 rounded shadow-sm">NEW</div>
                        <i class="fas fa-car text-purple-600 text-3xl mb-3 group-hover:scale-110 transition duration-300"></i>
                        <h4 class="text-sm font-extrabold text-purple-900">RC Print</h4>
                    </div>
                    <div onclick="openFarmerForm()" class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40 border-2 border-green-100 bg-green-50/20 group">
                        <div class="absolute top-2 right-2 bg-green-600 text-white text-[9px] font-bold px-2 py-0.5 rounded shadow-sm">NEW</div>
                        <i class="fas fa-leaf text-green-600 text-3xl mb-3 group-hover:scale-110 transition duration-300"></i>
                        <h4 class="text-sm font-extrabold text-green-900">Farmer ID</h4>
                    </div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-search text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Find PAN</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-check-circle text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">PAN Verify</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-university text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">Bank Verify</h4></div>
                    <div class="service-card p-4 rounded-2xl flex flex-col items-center justify-center text-center h-40"><i class="fas fa-id-badge text-gray-500 text-2xl mb-3"></i><h4 class="text-sm font-bold text-gray-700">DL Verify</h4></div>
                </div>
            </div>
        </main>
        
        <footer class="bg-slate-900 text-slate-400 py-12 text-center text-xs border-t border-slate-800">
            <p>&copy; 2025 Bharat Suvidha Kendra. All Rights Reserved.</p>
        </footer>
    </div>

    <div id="panFormModal" class="modal-container">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto animate-fade-up">
            <div class="bg-gradient-to-r from-blue-700 to-blue-800 p-6 text-white flex justify-between items-center sticky top-0 z-10">
                <div>
                    <h3 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-print"></i> Print PAN Card</h3>
                    <p class="text-blue-200 text-xs">Auto-filling template (Fee: ‚Çπ10)</p>
                </div>
                <button onclick="closeModal('panFormModal')" class="bg-white/20 hover:bg-white/30 rounded-full w-8 h-8 flex items-center justify-center transition">‚úï</button>
            </div>
            
            <form id="newPanForm" onsubmit="handlePanSubmit(event)" class="p-8 space-y-5">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                    <div>
                        <label class="form-label">PAN Number</label>
                        <input type="text" id="pan_number" required pattern="[A-Z]{5}[0-9]{4}[A-Z]{1}" class="w-full px-4 py-2.5 border rounded-lg uppercase font-mono border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="ABCDE1234F">
                    </div>
                    <div>
                        <label class="form-label">Date of Birth</label>
                        <input type="date" id="pan_dob" required class="w-full px-4 py-2.5 border rounded-lg border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <div class="md:col-span-2">
                        <label class="form-label">Full Name</label>
                        <input type="text" id="pan_name" required class="w-full px-4 py-2.5 border rounded-lg uppercase border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="RAJESH KUMAR">
                    </div>
                    <div class="md:col-span-2">
                        <label class="form-label">Father's Name</label>
                        <input type="text" id="pan_fname" required class="w-full px-4 py-2.5 border rounded-lg uppercase border-gray-300 focus:ring-2 focus:ring-blue-500 outline-none transition" placeholder="SURESH KUMAR">
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4 pt-4 border-t">
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center cursor-pointer hover:bg-blue-50 transition group" onclick="document.getElementById('pan_photo').click()">
                        <i class="fas fa-camera text-gray-400 mb-2 group-hover:text-blue-500"></i>
                        <p class="text-xs font-bold text-gray-600 group-hover:text-blue-600">Select Photo</p>
                        <input type="file" id="pan_photo" accept="image/*" class="hidden" onchange="previewImage(this, 'photo_preview')">
                        <img id="photo_preview" class="h-16 w-16 object-cover mx-auto mt-2 rounded hidden border shadow-sm">
                    </div>
                    <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center cursor-pointer hover:bg-blue-50 transition group" onclick="document.getElementById('pan_signature').click()">
                        <i class="fas fa-pen-nib text-gray-400 mb-2 group-hover:text-blue-500"></i>
                        <p class="text-xs font-bold text-gray-600 group-hover:text-blue-600">Select Signature</p>
                        <input type="file" id="pan_signature" accept="image/*" class="hidden" onchange="previewImage(this, 'sig_preview')">
                        <img id="sig_preview" class="h-8 w-auto object-contain mx-auto mt-2 hidden border shadow-sm">
                    </div>
                </div>

                <button type="submit" id="generateBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-3.5 rounded-xl shadow-lg flex justify-center items-center gap-2 mt-4 text-lg transition transform active:scale-95">
                    <i class="fas fa-print"></i> Confirm & Print (‚Çπ10)
                </button>
            </form>
        </div>
    </div>

    <div id="rcFormModal" class="modal-container">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto animate-fade-up">
            <div class="bg-gradient-to-r from-purple-600 to-purple-800 p-6 text-white flex justify-between items-center sticky top-0 z-10">
                <h3 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-car"></i> Vehicle RC Details</h3>
                <button onclick="closeModal('rcFormModal')" class="bg-white/20 hover:bg-white/30 rounded-full w-8 h-8 flex items-center justify-center transition">‚úï</button>
            </div>
            <form id="rcForm" onsubmit="handleRcSubmit(event)" class="p-8 grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <div class="space-y-4">
                    <h4 class="text-sm font-bold text-purple-700 border-b border-purple-100 pb-2 mb-4 uppercase tracking-wider">Front Card Details</h4>
                    <div><label class="form-label">Regn. No</label><input type="text" id="rc_regn_no" required class="form-input uppercase"></div>
                    <div><label class="form-label">Date of Regn.</label><input type="date" id="rc_regn_date" required class="form-input"></div>
                    <div><label class="form-label">Regn. Validity</label><input type="date" id="rc_regn_validity" required class="form-input"></div>
                    <div><label class="form-label">Chassis Number</label><input type="text" id="rc_chassis" required class="form-input uppercase"></div>
                    <div><label class="form-label">Engine Number</label><input type="text" id="rc_engine" required class="form-input uppercase"></div>
                    <div><label class="form-label">Owner Name</label><input type="text" id="rc_owner" required class="form-input uppercase"></div>
                    <div><label class="form-label">Address</label><textarea id="rc_address" required rows="2" class="form-input uppercase"></textarea></div>
                </div>

                <div class="space-y-4">
                    <h4 class="text-sm font-bold text-purple-700 border-b border-purple-100 pb-2 mb-4 uppercase tracking-wider">Back Card Details</h4>
                     <div class="grid grid-cols-2 gap-4">
                        <div><label class="form-label">Maker</label><input type="text" id="rc_maker" required class="form-input uppercase"></div>
                        <div><label class="form-label">Model</label><input type="text" id="rc_model" required class="form-input uppercase"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                         <div><label class="form-label">Color</label><input type="text" id="rc_color" required class="form-input uppercase"></div>
                         <div><label class="form-label">Weight (Kg)</label><input type="number" id="rc_weight" required class="form-input"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div><label class="form-label">Mfg Date (Mon/Yr)</label><input type="month" id="rc_mfg" required class="form-input"></div>
                        <div><label class="form-label">Financier</label><input type="text" id="rc_financier" class="form-input uppercase"></div>
                    </div>
                    <div><label class="form-label">Registration Authority</label><input type="text" id="rc_authority" required class="form-input uppercase"></div>
                </div>

                <div class="md:col-span-2 mt-2 pt-4 border-t border-gray-100">
                    <button type="submit" id="rcSubmitBtn" class="w-full bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800 text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-3 text-lg transition transform active:scale-95">
                        <i class="fas fa-print"></i> Print & Download (‚Çπ10)
                    </button>
                </div>
            </form>
        </div>
    </div>

     <div id="farmerIdModal" class="modal-container">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto animate-fade-up">
            <div class="bg-gradient-to-r from-green-600 to-green-800 p-6 text-white flex justify-between items-center sticky top-0 z-10">
                <h3 class="text-xl font-bold flex items-center gap-2"><i class="fas fa-tractor"></i> Farmer ID Card</h3>
                <button onclick="closeModal('farmerIdModal')" class="bg-white/20 hover:bg-white/30 rounded-full w-8 h-8 flex items-center justify-center transition">‚úï</button>
            </div>
            <form id="farmerForm" onsubmit="handleFarmerSubmit(event)" class="p-8 grid grid-cols-1 md:grid-cols-12 gap-6">
                
                <div class="md:col-span-4 flex flex-col items-center">
                     <label class="form-label mb-2 w-full text-center">Farmer Photo</label>
                    <div class="w-full border-2 border-dashed border-green-300 rounded-xl p-4 text-center cursor-pointer hover:bg-green-50 transition group h-64 flex flex-col justify-center items-center bg-gray-50" onclick="document.getElementById('farmer_photo').click()">
                        <i class="fas fa-camera text-green-400 text-4xl mb-3 group-hover:text-green-600"></i>
                        <p class="text-sm font-bold text-gray-600 group-hover:text-green-700">Click to Upload</p>
                        <input type="file" id="farmer_photo" accept="image/*" class="hidden" onchange="previewImage(this, 'farmer_photo_preview')">
                        <img id="farmer_photo_preview" class="h-32 w-32 object-cover mx-auto mt-4 rounded-lg hidden border-2 border-green-500 shadow-md">
                    </div>
                </div>

                <div class="md:col-span-8 grid grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="form-label text-green-800">Farmer ID Number</label>
                        <input type="text" id="farmer_id_num" required class="w-full px-5 py-3 border-2 border-green-600 rounded-lg bg-green-700 text-white font-extrabold text-xl tracking-widest focus:ring-4 focus:ring-green-300 outline-none transition uppercase shadow-inner" placeholder="MH-F-123456">
                    </div>

                    <div><label class="form-label">‡§®‡§æ‡§µ (Marathi)</label><input type="text" id="farmer_name_mar" required class="form-input" placeholder="‡§∞‡§æ‡§ú‡•á‡§∂ ‡§ï‡•Å‡§Æ‡§æ‡§∞"></div>
                    <div><label class="form-label">Name (English)</label><input type="text" id="farmer_name_eng" required class="form-input uppercase" placeholder="RAJESH KUMAR"></div>
                    
                    <div><label class="form-label">Date of Birth</label><input type="date" id="farmer_dob" required class="form-input"></div>
                    <div>
                        <label class="form-label">Gender</label>
                        <select id="farmer_gender" required class="form-input">
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>

                    <div><label class="form-label">Mobile</label><input type="tel" id="farmer_mobile" pattern="[0-9]{10}" required class="form-input" placeholder="9876543210"></div>
                    <div><label class="form-label">Aadhaar No.</label><input type="text" id="farmer_aadhaar" pattern="[0-9]{12}" required class="form-input" placeholder="1234 5678 9012"></div>
                </div>
                
                <div class="md:col-span-12 grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-gray-200 pt-4">
                     <div><label class="form-label">‡§™‡§§‡•ç‡§§‡§æ (Address in Marathi)</label><textarea id="farmer_addr_mar" required rows="2" class="form-input"></textarea></div>
                     <div><label class="form-label">Address (English)</label><textarea id="farmer_addr_eng" required rows="2" class="form-input uppercase"></textarea></div>
                </div>

                <div class="md:col-span-12 mt-2">
                    <button type="submit" id="farmerSubmitBtn" class="w-full bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white font-bold py-4 rounded-xl shadow-lg flex justify-center items-center gap-3 text-lg transition transform active:scale-95">
                        <i class="fas fa-print"></i> Print & Download (‚Çπ10)
                    </button>
                </div>
            </form>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    
    <script>
        // 1. FIREBASE CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyAKEeuQkW8Ry-365dYos96Dzp0TlO_Upog",
            authDomain: "bharat-suvidha-faeee.firebaseapp.com",
            projectId: "bharat-suvidha-faeee",
            storageBucket: "bharat-suvidha-faeee.firebasestorage.app",
            messagingSenderId: "969934230576",
            appId: "1:969934230576:web:8d2bbcf3e5cf3d689c09f5",
            measurementId: "G-PNJ0DQ9EQJ"
        };
        
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        let currentUser = null;

        // --- UI HELPERS ---
        function closeModal(modalId) { document.getElementById(modalId).style.display = 'none'; }
        function openPanForm() { document.getElementById('panFormModal').style.display = 'flex'; }
        function openRcForm() { document.getElementById('rcFormModal').style.display = 'flex'; }
        function openFarmerForm() { document.getElementById('farmerIdModal').style.display = 'flex'; }

        // Image Preview
        function previewImage(input, id) {
            if (input.files && input.files[0]) {
                var reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(id).src = e.target.result;
                    document.getElementById(id).classList.remove('hidden');
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // --- AUTH & WALLET ---
        async function handleLogin(e) {
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const errorBox = document.getElementById('loginError');
            btn.innerHTML = '<span class="loader"></span>';
            errorBox.classList.add('hidden');
            try {
                await auth.signInWithEmailAndPassword(
                    document.getElementById('userid').value,
                    document.getElementById('password').value
                );
            } catch (error) {
                btn.innerHTML = 'SECURE LOGIN <i class="fas fa-arrow-right"></i>';
                errorBox.innerText = "Error: " + error.code;
                errorBox.classList.remove('hidden');
            }
        }

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('loginGate').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                document.getElementById('welcomeUser').innerText = user.email;
                loadWallet(user);
            } else {
                currentUser = null;
                document.getElementById('loginGate').style.display = 'flex';
                document.getElementById('dashboard').style.display = 'none';
            }
        });

        async function loadWallet(user) {
            const walletRef = db.collection('users').doc(user.uid);
            try {
                const doc = await walletRef.get();
                if (doc.exists) {
                    updateWalletUI(doc.data().balance);
                } else {
                    await walletRef.set({ email: user.email, balance: 0 });
                    updateWalletUI(0);
                }
            } catch (e) { console.error(e); }
        }

        function updateWalletUI(amount) {
            const el = document.getElementById('walletBalance');
            el.innerText = "‚Çπ " + parseFloat(amount || 0).toFixed(2);
            if (amount > 50) el.classList.add("text-green-400");
        }

        function addMoney() {
            if (!currentUser) return;
            let amount = prompt("Enter amount (e.g. 100):");
            if (!amount || amount < 1) return;

            var options = {
                "key": "rzp_live_RyxBU2CVQ5QLdp",
                "amount": amount * 100,
                "currency": "INR",
                "name": "Bharat Suvidha",
                "description": "Recharge",
                "handler": async function (response) {
                    const walletRef = db.collection('users').doc(currentUser.uid);
                    const doc = await walletRef.get();
                    const newBal = (doc.data().balance || 0) + parseInt(amount);
                    await walletRef.update({ balance: newBal });
                    updateWalletUI(newBal);
                    alert("Success! Balance Updated.");
                },
                "theme": { "color": "#2563eb" }
            };
            if (typeof Razorpay !== 'undefined') new Razorpay(options).open();
            else alert("Payment gateway blocked.");
        }

        // --- SHARED WALLET DEBIT LOGIC ---
        async function debitWallet(amount, btnId, originalText) {
            const btn = document.getElementById(btnId);
            btn.innerHTML = '<span class="loader"></span> Processing...';
            btn.disabled = true;

            const walletRef = db.collection('users').doc(currentUser.uid);
            try {
                const doc = await walletRef.get();
                const currentBal = doc.data().balance || 0;
                
                if (currentBal < amount) {
                    alert(`Insufficient Balance! You need ‚Çπ${amount}.`);
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                    return false;
                }

                const newBal = currentBal - amount;
                await walletRef.update({ balance: newBal });
                updateWalletUI(newBal);
                return true;
            } catch (error) {
                console.error(error);
                alert("Transaction Error: " + error.message);
                btn.innerHTML = originalText;
                btn.disabled = false;
                return false;
            }
        }

        // --- RC SUBMIT HANDLER ---
        async function handleRcSubmit(e) {
            e.preventDefault();
            const success = await debitWallet(10, 'rcSubmitBtn', '<i class="fas fa-print"></i> Print & Download (‚Çπ10)');
            if (success) {
                await generateRcPdf();
                document.getElementById('rcSubmitBtn').innerHTML = '<i class="fas fa-print"></i> Print & Download (‚Çπ10)';
                document.getElementById('rcSubmitBtn').disabled = false;
                closeModal('rcFormModal');
                alert("Success! RC PDF Generated.");
            }
        }

        // --- FARMER SUBMIT HANDLER ---
        async function handleFarmerSubmit(e) {
            e.preventDefault();
            const success = await debitWallet(10, 'farmerSubmitBtn', '<i class="fas fa-print"></i> Print & Download (‚Çπ10)');
            if (success) {
                await generateFarmerPdf();
                document.getElementById('farmerSubmitBtn').innerHTML = '<i class="fas fa-print"></i> Print & Download (‚Çπ10)';
                document.getElementById('farmerSubmitBtn').disabled = false;
                closeModal('farmerIdModal');
                alert("Success! Farmer ID Generated.");
            }
        }
        
        // --- PAN HANDLER ---
        async function handlePanSubmit(e) {
            e.preventDefault();
            const success = await debitWallet(10, 'generateBtn', '<i class="fas fa-print"></i> Confirm & Print (‚Çπ10)');
            if (success) {
                await generatePanPdf();
                document.getElementById('generateBtn').innerHTML = '<i class="fas fa-print"></i> Confirm & Print (‚Çπ10)';
                document.getElementById('generateBtn').disabled = false;
                closeModal('panFormModal');
                alert("Success! PAN PDF Generated.");
            }
        }


        // --- PDF GENERATORS ---

        // 1. RC PDF
        async function generateRcPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            
            // Background
            try {
                // Assuming 'vehicle.jpg' contains both Front and Back side by side or top/bottom
                // We will scale it to fit the A4 page roughly
                const bg = await loadImage('vehicle.jpg'); 
                doc.addImage(bg, 'JPEG', 0, 0, 210, 297); // Adjust width/height based on aspect ratio
            } catch (e) {
                console.warn("vehicle.jpg not found");
                doc.text("RC Template Missing", 10, 10);
            }

            doc.setFont("helvetica", "bold");
            doc.setFontSize(9);
            
            // Mapping fields to arbitrary coordinates on top of the image
            // You will need to fine-tune these X,Y values based on your actual 'vehicle.jpg'
            
            // FRONT
            doc.text(document.getElementById('rc_regn_no').value.toUpperCase(), 40, 30);
            doc.text(document.getElementById('rc_regn_date').value, 40, 38);
            doc.text(document.getElementById('rc_chassis').value.toUpperCase(), 40, 46);
            doc.text(document.getElementById('rc_owner').value.toUpperCase(), 40, 54);
            doc.text(document.getElementById('rc_address').value.toUpperCase(), 40, 62, {maxWidth: 50});

            // BACK (Assuming back is on the right side of the image or lower)
            doc.text(document.getElementById('rc_maker').value.toUpperCase(), 130, 30);
            doc.text(document.getElementById('rc_model').value.toUpperCase(), 130, 38);
            doc.text(document.getElementById('rc_color').value.toUpperCase(), 130, 46);
            doc.text(document.getElementById('rc_weight').value, 130, 54);
            doc.text(document.getElementById('rc_financier').value.toUpperCase(), 130, 62);
            
            doc.save("RC_" + document.getElementById('rc_regn_no').value + ".pdf");
        }

        // 2. FARMER PDF
        async function generateFarmerPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');

            try {
                const bg = await loadImage('farmerid.jpg'); 
                doc.addImage(bg, 'JPEG', 0, 0, 210, 297); 
            } catch (e) {
                console.warn("farmerid.jpg not found");
            }

            doc.setFont("helvetica", "bold");
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(10);

            // Coordinates (Estimated)
            const photo = document.getElementById('farmer_photo_preview').src;
            if (photo.startsWith('data:')) {
                doc.addImage(photo, 'JPEG', 15, 25, 25, 30); // Photo Position
            }

            // Text Fields
            doc.text(document.getElementById('farmer_name_eng').value.toUpperCase(), 50, 30);
            doc.text(document.getElementById('farmer_name_mar').value, 50, 36);
            doc.text("DOB: " + document.getElementById('farmer_dob').value, 50, 42);
            doc.text("Mobile: " + document.getElementById('farmer_mobile').value, 50, 48);
            
            // Farmer ID (Styled)
            doc.setTextColor(255, 255, 255); // White text
            doc.setFontSize(12);
            // Assuming there is a dark box in the template for the ID
            doc.text(document.getElementById('farmer_id_num').value.toUpperCase(), 15, 75); 

            doc.save("FarmerID_" + document.getElementById('farmer_id_num').value + ".pdf");
        }

        // 3. PAN PDF (Existing)
        async function generatePanPdf() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF('p', 'mm', 'a4');
            try {
                const bg = await loadImage('1000067800.jpg'); 
                doc.addImage(bg, 'JPEG', 0, 0, 210, 297);
            } catch (e) { console.warn("pan bg missing"); }

            const name = document.getElementById('pan_name').value.toUpperCase();
            const fname = document.getElementById('pan_fname').value.toUpperCase();
            const dob = document.getElementById('pan_dob').value.split('-').reverse().join('/');
            const pan = document.getElementById('pan_number').value.toUpperCase();
            const photo = document.getElementById('photo_preview').src;
            const sig = document.getElementById('sig_preview').src;

            doc.setFont("helvetica", "bold");
            doc.setTextColor(0, 0, 0);

            doc.setFontSize(11);
            doc.text(pan, 140, 30);  
            doc.setFontSize(10);
            doc.text(name, 65, 75); 
            doc.text(fname, 65, 90); 
            doc.text(dob, 65, 105); 

            if (photo.startsWith('data:')) doc.addImage(photo, 'JPEG', 12, 140, 25, 30);
            if (sig.startsWith('data:')) doc.addImage(sig, 'PNG', 80, 150, 40, 10);

            doc.setFontSize(6);
            doc.text(name, 29, 262); 
            doc.text(fname, 29, 268); 
            doc.text(dob, 29, 277); 
            doc.setFontSize(8);
            doc.text(pan, 52, 252);
            
            if (photo.startsWith('data:')) doc.addImage(photo, 'JPEG', 33, 245, 13, 14);
            if (sig.startsWith('data:')) doc.addImage(sig, 'PNG', 56, 272, 20, 5);

            doc.save(name + "_PAN.pdf");
        }

        function loadImage(url) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = () => reject(new Error("Img Error"));
                img.src = url;
            });
        }

        window.logout = function() {
            auth.signOut().then(() => location.reload());
        }
    </script>
</body>
</html>


